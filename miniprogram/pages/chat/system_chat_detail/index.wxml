<TitleBar title="{{convName}}" />

<scroll-view
  class="container"
  scroll-y="{{true}}"
  bindscrolltolower="onReachBottom"
  lower-threshold="200"
>
  <view
    wx:for="{{messages}}"
    wx:for-item="msg"
    wx:for-index="idx"
    wx:key="rawId"
    class="msg-item"
    bindtap="gotoDetail"
    data-msg="{{msg}}"
  >
    <image class="avatar" src="{{msg.operator.avatar_url}}" mode="aspectFill" />
    <view class="dot" wx:if="{{conversation.unreadCount > idx}}" />
    <view class="info">
      <view class="line1">
        <view class="name">{{msg.operator.name}}</view>
        <view class="time">{{msg.timeStr}}</view>
      </view>
      <view class="line2">{{msg.text}}</view>
    </view>
    <image
      wx:if="{{msg.commodity && msg.commodity.img_urls.length > 0}}"
      class="image" mode="aspectFill" src="{{msg.commodity.img_urls[0]}}/card"
    />
    <image
      wx:elif="{{msg.help && msg.help.img_urls.length > 0}}"
      class="image" mode="aspectFill" src="{{msg.help.img_urls[0]}}/card"
    />
    <TextPreview wx:else content="{{msg.commodityDesc || msg.helpDesc}}" class="text-preview" />
  </view>
  <image wx:if="{{messages.length === 0}}" src="/images/empty.png" mode="aspectFit" class="empty" />
</scroll-view>
