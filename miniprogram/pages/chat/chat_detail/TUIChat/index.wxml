<view class="container">
  <UserTitleBar user="{{isSeller ? buyer : seller}}" />
  <view class="status-area" wx:if="{{commodity}}">
    <image class="image" mode="aspectFill" src="{{commodity.img_urls[0]}}" bindtap="gotoCommodityDetail" />
    <view class="info" bindtap="gotoCommodityDetail">
      <text class="title">{{commodityDesc}}</text>
      <text class="price">￥{{commodity.price}}</text>
      <image class="status" src="{{statusImage}}" />
    </view>
    <view class="actions">
      <block wx:if="{{isSeller}}">
        <block wx:if='{{transaction.status === TransactionStatus.Idle}}'>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.RequestingBooking}}'>
          <view class="button" bindtap="agreeBooking">同意预定</view>
          <view class="button yellow" bindtap="denyBooking">拒绝预定</view>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.Booked}}'>
          <view class="button" bindtap="confirmSold">已售出</view>
          <view class="button yellow" bindtap="confirmTerminated">未售出</view>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.Finished}}'>
          <view class="button disabled">已完成</view>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.Terminated}}'>
          <view class="button disabled">已终止</view>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.Closed}}'>
          <view class="button disabled">商品已下架</view>
        </block>
      </block>
      <block wx:else>
        <block wx:if='{{transaction.status === TransactionStatus.Idle}}'>
          <view class="button" bindtap="requestBooking">预定</view>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.RequestingBooking}}'>
          <view class="button" bindtap="cancelBooking">取消预订</view>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.Denied}}'>
          <view class="button disabled">预约被拒绝</view>
          <view class="button" bindtap="requestBooking">重新预定</view>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.Booked}}'>
          <view class="button disabled">已预定</view>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.Finished}}'>
          <view class="button disabled">已完成</view>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.Terminated}}'>
          <view>已终止</view>
          <view class="button" bindtap="requestBooking">重新预定</view>
        </block>
        <block wx:elif='{{transaction.status === TransactionStatus.Closed}}'>
          <view class="button disabled">商品已下架</view>
        </block>
      </block>
    </view>
  </view>
  <view class="tip" wx:if="{{tip}}">{{tip}}</view>
  <view
    class="list-box">
    <scroll-view class="message-list" bindtap="triggerClose" scroll-y="true">
      <MessageList
        id="MessageList"
        conversation="{{conversation}}"
        unreadCount="{{unreadCount}}"
        chatContainerHeight="{{chatContainerHeight}}"
        bind:resendMessage="resendMessage"
        bind:typing="typing"
      />
    </scroll-view>
  </view>
  <view class="input-area">
    <view class="message-input" style="{{viewData.style}}">
      <MessageInput
        id="MessageInput"
        conversation="{{conversation}}"
        hasCallKit="{{false}}"
        bind:sendMessage="onSendMessage"
        bind:downKeysBoards="downKeysBoards"
        bind:pullKeysBoards="pullKeysBoards"
        bind:showMessageErrorImage="showMessageErrorImage"
        bind:handleCall="handleCall"
        bind:inputHeightChange="inputHeightChange"
      ></MessageInput>
    </view>
  </view>
</view>
